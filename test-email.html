<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fanova Email Test</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', sans-serif;
      background: #fafafa;
      padding: 40px 20px;
      line-height: 1.6;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 40px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    h1 {
      color: #18181b;
      font-size: 28px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .subtitle {
      color: #71717a;
      font-size: 14px;
      margin-bottom: 32px;
    }

    .section {
      margin-bottom: 32px;
    }

    h2 {
      color: #18181b;
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 16px;
    }

    label {
      display: block;
      color: #52525b;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 8px;
    }

    input {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid #e4e4e7;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.2s;
    }

    input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .button-group {
      display: flex;
      gap: 12px;
      margin-top: 16px;
    }

    button {
      flex: 1;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5a67d8;
    }

    .btn-success {
      background: #22c55e;
      color: white;
    }

    .btn-success:hover {
      background: #16a34a;
    }

    .btn-info {
      background: #3b82f6;
      color: white;
    }

    .btn-info:hover {
      background: #2563eb;
    }

    .btn-check {
      background: #f4f4f5;
      color: #52525b;
    }

    .btn-check:hover {
      background: #e4e4e7;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .result {
      margin-top: 16px;
      padding: 16px;
      border-radius: 8px;
      font-size: 14px;
      display: none;
    }

    .result.show {
      display: block;
    }

    .result.success {
      background: #f0fdf4;
      border: 1px solid #86efac;
      color: #166534;
    }

    .result.error {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #b91c1c;
    }

    .result.info {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      color: #1e40af;
    }

    .result pre {
      margin-top: 8px;
      background: rgba(0, 0, 0, 0.05);
      padding: 8px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }

    .warning {
      background: #fef3c7;
      border: 1px solid #fbbf24;
      color: #78350f;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 32px;
      font-size: 14px;
    }

    .warning strong {
      display: block;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìß Fanova Email Test</h1>
    <p class="subtitle">Test your Resend email integration</p>

    <div class="warning">
      <strong>‚ö†Ô∏è Important:</strong>
      Make sure your server is running on port 5000. If you haven't verified your domain in Resend yet, emails will only be sent to the email address associated with your Resend account.
    </div>

    <div class="section">
      <h2>Configuration Check</h2>
      <button class="btn-check" onclick="checkConfig()">Check Resend Config</button>
      <div id="configResult" class="result"></div>
    </div>

    <div class="section">
      <h2>Test Email</h2>
      <label for="email">Your Email Address</label>
      <input type="email" id="email" placeholder="your@email.com" required>

      <div class="button-group">
        <button class="btn-primary" onclick="sendTest('welcome')">
          Welcome Email
        </button>
        <button class="btn-info" onclick="sendTest('first-model')">
          First Model Email
        </button>
        <button class="btn-success" onclick="sendTest('subscription')">
          Subscription Email
        </button>
      </div>

      <div id="testResult" class="result"></div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:5000/api';

    async function checkConfig() {
      const resultDiv = document.getElementById('configResult');
      resultDiv.className = 'result info show';
      resultDiv.innerHTML = 'üîÑ Checking configuration...';

      try {
        const response = await fetch(`${API_URL}/test-email/config`);
        const data = await response.json();

        if (data.configured) {
          resultDiv.className = 'result success show';
          resultDiv.innerHTML = `
            ‚úÖ <strong>Resend is configured!</strong><br>
            API Key: ${data.apiKeyPrefix}<br>
            Frontend URL: ${data.frontendUrl}
          `;
        } else {
          resultDiv.className = 'result error show';
          resultDiv.innerHTML = `
            ‚ùå <strong>Resend is NOT configured</strong><br>
            ${data.message}
          `;
        }
      } catch (error) {
        resultDiv.className = 'result error show';
        resultDiv.innerHTML = `
          ‚ùå <strong>Error checking configuration</strong><br>
          ${error.message}<br>
          <em>Make sure the server is running on port 5000</em>
        `;
      }
    }

    async function sendTest(type) {
      const email = document.getElementById('email').value;
      const resultDiv = document.getElementById('testResult');

      if (!email) {
        resultDiv.className = 'result error show';
        resultDiv.innerHTML = '‚ùå Please enter an email address';
        return;
      }

      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        resultDiv.className = 'result error show';
        resultDiv.innerHTML = '‚ùå Please enter a valid email address';
        return;
      }

      resultDiv.className = 'result info show';
      resultDiv.innerHTML = `üîÑ Sending ${type} email to ${email}...`;

      try {
        const response = await fetch(`${API_URL}/test-email/${type}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ email })
        });

        const data = await response.json();

        if (data.success) {
          resultDiv.className = 'result success show';
          resultDiv.innerHTML = `
            ‚úÖ <strong>${data.message}</strong><br>
            Email sent to: ${email}<br>
            Check your inbox (and spam folder)!
            ${data.data ? `<pre>${JSON.stringify(data.data, null, 2)}</pre>` : ''}
          `;
        } else {
          resultDiv.className = 'result error show';
          resultDiv.innerHTML = `
            ‚ùå <strong>Failed to send email</strong><br>
            ${data.error || data.message || 'Unknown error'}
            ${data.error ? `<pre>${JSON.stringify(data.error, null, 2)}</pre>` : ''}
          `;
        }
      } catch (error) {
        resultDiv.className = 'result error show';
        resultDiv.innerHTML = `
          ‚ùå <strong>Request failed</strong><br>
          ${error.message}<br>
          <em>Make sure the server is running on port 5000</em>
        `;
      }
    }

    // Auto-check config on load
    window.addEventListener('load', () => {
      setTimeout(checkConfig, 500);
    });
  </script>
</body>
</html>
